from jwcrypto import jwe, jwk
import json

# Load key
k = '{"alg":"A128CBC-HS256","k":"_m-oZljsyhkMMv9JwFhZxKLmaWKl26dMhwBRZpZZYKI","kty":"oct"}'
key_params = json.loads(k)
key = jwk.JWK(**key_params)

# IP packet copied from Wireshark
ip_packet = \
    "\x45\x00\x01\x04\x3d\x18\x40\x00\x40\x11\xd1\xae\xc0\xa8\x02\x02" \
    "\x81\x92\xe6\xe5\xc0\x5c\x01\xbb\x00\xf0\x12\x44\x00\x01\x00\xd4" \
    "\x21\x12\xa4\x42\x47\x79\x4e\x61\x64\x46\x32\x75\x70\x34\x37\x38" \
    "\x80\x30\x00\xce\x00\x00\xb0\x0f\x65\x79\x4a\x68\x62\x47\x63\x69" \
    "\x4f\x69\x4a\x6b\x61\x58\x49\x69\x4c\x43\x4a\x6c\x62\x6d\x4d\x69" \
    "\x4f\x69\x4a\x42\x4d\x54\x49\x34\x51\x30\x4a\x44\x4c\x55\x68\x54" \
    "\x4d\x6a\x55\x32\x49\x6e\x30\x2e\x2e\x32\x70\x43\x52\x74\x63\x50" \
    "\x66\x53\x30\x53\x7a\x42\x71\x69\x4f\x5a\x69\x58\x4b\x6a\x51\x2e" \
    "\x64\x57\x58\x4a\x44\x34\x54\x49\x61\x7a\x79\x34\x69\x54\x49\x53" \
    "\x39\x73\x35\x4e\x73\x4e\x32\x57\x75\x34\x79\x73\x5a\x61\x49\x43" \
    "\x73\x64\x43\x65\x36\x64\x73\x57\x64\x46\x33\x48\x75\x34\x63\x63" \
    "\x72\x70\x32\x4d\x4d\x50\x2d\x55\x67\x54\x49\x50\x72\x62\x6d\x74" \
    "\x6d\x6a\x59\x35\x52\x47\x37\x39\x54\x4b\x74\x47\x4b\x48\x68\x66" \
    "\x38\x78\x43\x66\x6b\x33\x61\x5f\x64\x30\x4c\x6e\x71\x49\x63\x4d" \
    "\x35\x47\x70\x4c\x73\x7a\x69\x6e\x4c\x51\x73\x2e\x45\x4b\x4a\x2d" \
    "\x2d\x30\x6d\x64\x79\x79\x33\x46\x49\x68\x4d\x7a\x4a\x44\x63\x54" \
    "\x69\x41\x00\x00"

# Offset of STUN attribute with token
STUN_ATTRIBUTE_OFFSET = 52

# Length of STUN attribute (without padding)
STUN_ATTRIBUTE_LENGTH = 206

# Extract the token
start = STUN_ATTRIBUTE_OFFSET + 4
end = STUN_ATTRIBUTE_OFFSET + STUN_ATTRIBUTE_LENGTH
token = ip_packet[start:end]
print('Token: `%s`' % token)

# Decrypt
jwetoken = jwe.JWE()
jwetoken.deserialize(token)
jwetoken.decrypt(key)

# Show payload
print (jwetoken.payload)
